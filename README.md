## API Документация

Базовый URL: `http://localhost:3000`

Аутентификация использует Bearer Access Token. Для защищённых эндпоинтов передавайте заголовок:

`Authorization: Bearer <accessToken>`

Токены выдаются при регистрации/входе и могут обновляться по `refreshToken`.

### Авторизация

1) POST `/signup`
- **Описание**: Регистрация пользователя и одновременное создание сессии
- **Тело**: `{ "id": string, "password": string }`
- **Коды**: `201` при успехе, `400` при ошибке валидации/конфликте
- **Ответ**:
```json
{
  "accessToken": "string",
  "refreshToken": "string",
  "accessExpiresAt": 1730000000000,
  "refreshExpiresAt": 1730000000000,
  "sessionId": "uuid"
}
```

2) POST `/signin`
- **Описание**: Вход пользователя, создаёт новую сессию
- **Тело**: `{ "id": string, "password": string }`
- **Коды**: `200` при успехе, `400` при пустых полях, `401` при неверных данных
- **Ответ**: как в `/signup`

3) POST `/signin/new_token`
- **Описание**: Обновление пары токенов по `refreshToken`
- **Тело**: `{ "refreshToken": string }`
- **Коды**: `200` при успехе, `400` при отсутствии тела, `401` при неверном/просроченном `refreshToken`
- **Ответ**: как в `/signup`

4) GET `/info`
- **Защита**: Требуется `Authorization: Bearer <accessToken>`
- **Описание**: Возвращает идентификатор текущего пользователя
- **Коды**: `200`, `401` если неавторизовано
- **Ответ**: `{ "id": string }`

5) GET `/logout`
- **Защита**: Требуется `Authorization`
- **Описание**: Помечает текущую сессию как отозванную (выход только с текущего устройства)
- **Коды**: `200`, `401` если неавторизовано
- **Ответ**: `{ "message": "ok" }`

### Работа с файлами

Все эндпоинты ниже требуют заголовок `Authorization: Bearer <accessToken>`.

1) POST `/file/upload`
- **Описание**: Загрузка нового файла
- **Форма**: `multipart/form-data` с полем `file` (один файл)
- **Коды**: `201` при успехе, `400` если файл не передан, `401` если неавторизовано
- **Ответ**: объект файла
```json
{
  "id": "uuid",
  "user_id": "string",
  "name": "original-name.ext",
  "extension": "ext | null",
  "mime_type": "string | null",
  "size": 123,
  "uploaded_at": 1730000000000,
  "path": "/abs/path/on/server"
}
```

2) GET `/file/list`
- **Параметры query**:
  - `list_size` — количество на странице (1..100, по умолчанию 10)
  - `page` — номер страницы (>=1, по умолчанию 1)
- **Ответ**:
```json
{
  "items": [ /* массив объектов файла, см. выше */ ],
  "total": 42,
  "page": 1,
  "pageSize": 10,
  "pages": 5
}
```

3) GET `/file/:id`
- **Описание**: Получение метаданных конкретного файла
- **Коды**: `200`, `404` если не найден, `401` если неавторизовано
- **Ответ**: объект файла

4) GET `/file/download/:id`
- **Описание**: Скачивание бинарного содержимого файла
- **Заголовки ответа**:
  - `Content-Type: <mime_type | application/octet-stream>`
  - `Content-Disposition: attachment; filename="<original-name>"`
- **Коды**: `200`, `404`, `401`
- **Тело ответа**: бинарное содержимое файла

5) DELETE `/file/delete/:id`
- **Описание**: Удаление файла пользователя
- **Коды**: `200` с `{ "ok": true|false }`, `401`
- **Ответ**: `{ "ok": boolean }`

6) PUT `/file/update/:id`
- **Описание**: Замена содержимого и метаданных файла
- **Форма**: `multipart/form-data` с полем `file`
- **Коды**: `200`, `400` если файл не передан, `404` если не найден, `401`
- **Ответ**: обновлённый объект файла

### Заголовки и форматы
- **Content-Type**:
  - Для JSON: `application/json`
  - Для загрузки/обновления файла: `multipart/form-data`
- **Authorization**: `Bearer <accessToken>`

### Переменные окружения
- `JWT_SECRET` — секрет подписи JWT (обязательно в продакшене)
- `ACCESS_TTL_MIN` — TTL access-токена в минутах (по умолчанию 10)
- `REFRESH_TTL_MIN` — TTL refresh-токена в минутах (по умолчанию 7×24×60)
- `PORT` — порт HTTP-сервера (по умолчанию 3000)

### Замечания по безопасности
- `logout` отзывает только текущую сессию; другие устройства остаются активны
- Доступ к файлам строго изолирован по `user_id`
- При обновлении токенов refresh-токен ротируется; храните его как секрет
